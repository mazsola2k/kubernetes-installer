# KubeVirt Status Tasks (new file for modular status checks)
# Controller remains top-level; do not edit here.

- name: Display KubeVirt status start banner
  ansible.builtin.debug:
    msg:
      - "=== KubeVirt Status Check ==="
      - "Namespace: {{ kubevirt_namespace | default('kubevirt') }}"

- name: Check KubeVirt namespace
  kubernetes.core.k8s_info:
    api_version: v1
    kind: Namespace
    name: "{{ kubevirt_namespace | default('kubevirt') }}"
  register: kubevirt_ns
  failed_when: false

- name: Check KubeVirt CustomResource
  kubernetes.core.k8s_info:
    api_version: kubevirt.io/v1
    kind: KubeVirt
    name: kubevirt
    namespace: "{{ kubevirt_namespace | default('kubevirt') }}"
  register: kubevirt_cr
  failed_when: false

- name: List KubeVirt pods
  ansible.builtin.shell: kubectl get pods -n {{ kubevirt_namespace | default('kubevirt') }}
  register: kubevirt_pods
  failed_when: false
  changed_when: false

- name: Display KubeVirt status summary
  ansible.builtin.debug:
    msg:
      - "=== KubeVirt Status Summary ==="
      - "Namespace: {{ 'PRESENT' if (kubevirt_ns.resources | default([]) | length > 0) else 'MISSING' }}"
      - "CustomResource: {{ 'DEPLOYED' if (kubevirt_cr.resources | default([]) | length > 0) else 'MISSING' }}"
      - "Phase: {{ kubevirt_cr.resources[0].status.phase | default('Unknown') if (kubevirt_cr.resources | default([]) | length > 0) else 'N/A' }}"
      - "Pods:"
      - "{{ kubevirt_pods.stdout_lines | default(['No pods found']) }}"
